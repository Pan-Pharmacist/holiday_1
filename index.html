<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.11/index.global.min.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>

    <style>
        /* ... (CSS ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î) ... */
        :root { --primary: #818cf8; --secondary: #f472b6; }
        body { font-family: 'Sarabun', sans-serif; background-color: #f8fafc; color: #334155; }
        .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.6); box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.05); }
        .nav-item.active { background: #e0e7ff; color: #4338ca; border-right: 4px solid #4338ca; font-weight: 600; }
        .page-transition { animation: fadeUp 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes fadeUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        
        .fc-event { border: none !important; border-radius: 4px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); margin-bottom: 2px !important; }
        .day-count-badge { position: absolute; top: 2px; right: 2px; background: #ef4444; color: white; border-radius: 99px; min-width: 20px; height: 20px; font-size: 0.75rem; display: flex; justify-content: center; align-items: center; font-weight: bold; padding: 0 4px; z-index: 5; box-shadow: 0 2px 4px rgba(0,0,0,0.2); pointer-events: none; }
        .loading-overlay { position: fixed; inset: 0; background: rgba(255,255,255,0.6); backdrop-filter: blur(4px); z-index: 9999; display: flex; justify-content: center; align-items: center; }
        
        .fc-event-main { padding: 2px 4px; overflow: hidden; }
        .evt-name { font-weight: 700; font-size: 0.85em; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .evt-type { font-size: 0.75em; opacity: 0.9; display: block; line-height: 1; margin-top: 1px; }
        .evt-note { font-size: 0.7em; font-style: italic; opacity: 0.7; display: block; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-top: 1px; }
    </style>
</head>
<body class="overflow-hidden h-screen w-screen flex text-slate-700">

    <div id="loginPage" class="fixed inset-0 z-50 flex items-center justify-center bg-gradient-to-br from-indigo-100 via-purple-100 to-pink-100">
        <div class="glass p-10 rounded-3xl w-full max-w-sm shadow-xl text-center">
            <div class="w-20 h-20 bg-gradient-to-tr from-indigo-400 to-purple-400 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-lg text-white text-3xl transform rotate-3">
                <i class="fa-solid fa-staff-snake"></i>
            </div>
            <h1 class="text-2xl font-bold text-gray-800 mb-1">‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£</h1>
            <p class="text-gray-500 mb-8 text-sm font-light">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£‡∏£‡∏° ‡∏á‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏õ‡πà‡∏ß‡∏¢‡∏ô‡∏≠‡∏Å</p>
            <form id="loginForm" class="space-y-4 text-left">
                <div><label class="text-xs font-bold text-indigo-400 uppercase ml-1">Username</label><input type="text" id="user" class="w-full px-4 py-3 rounded-xl bg-white/50 border border-white focus:ring-2 focus:ring-indigo-300 outline-none transition placeholder-gray-400" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ" required></div>
                <div><label class="text-xs font-bold text-indigo-400 uppercase ml-1">Password</label><input type="password" id="pass" class="w-full px-4 py-3 rounded-xl bg-white/50 border border-white focus:ring-2 focus:ring-indigo-300 outline-none transition placeholder-gray-400" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô" required></div>
                <button type="submit" id="loginBtn" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white font-bold py-3.5 rounded-xl shadow-lg hover:shadow-xl transition-all transform active:scale-95 flex justify-center items-center gap-2"><span>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</span></button>
            </form>
        </div>
    </div>

    <nav id="sidebar" class="w-64 bg-white border-r border-slate-100 h-full hidden flex-col z-20 shadow-sm">
        <div class="p-6 flex items-center gap-3">
            <div class="w-10 h-10 bg-indigo-500 rounded-xl text-white flex items-center justify-center text-xl shadow-md"><i class="fa-solid fa-clinic-medical"></i></div>
            <div><h2 class="font-bold text-slate-800 leading-tight">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•<br>‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£</h2></div>
        </div>
        <div class="flex-1 overflow-y-auto py-4 px-3 space-y-1">
            <button onclick="nav('dashboard')" class="nav-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3 text-slate-500 hover:bg-slate-50 transition active"><i class="fa-solid fa-chart-pie w-5"></i> ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            <button onclick="nav('form')" class="nav-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3 text-slate-500 hover:bg-slate-50 transition"><i class="fa-solid fa-file-pen w-5"></i> ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏•‡∏≤</button>
            <button onclick="nav('calendar')" class="nav-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3 text-slate-500 hover:bg-slate-50 transition"><i class="fa-regular fa-calendar-days w-5"></i> ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô</button>
            <button onclick="nav('history')" class="nav-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3 text-slate-500 hover:bg-slate-50 transition"><i class="fa-solid fa-clock-rotate-left w-5"></i> ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</button>
            <div id="adminMenu" class="hidden pt-6 mt-4 border-t border-slate-100">
                <p class="px-4 text-[10px] font-bold text-slate-400 mb-2 uppercase tracking-widest">Admin Control</p>
                <button onclick="nav('adminQuota')" class="nav-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3 text-purple-600 hover:bg-purple-50"><i class="fa-solid fa-lock w-5"></i> ‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤ & ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î</button>
                <button onclick="nav('adminReport')" class="nav-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3 text-purple-600 hover:bg-purple-50"><i class="fa-solid fa-file-csv w-5"></i> ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô & Logs</button>
                <button onclick="nav('adminUsers')" class="nav-item w-full text-left px-4 py-3 rounded-xl flex items-center gap-3 text-purple-600 hover:bg-purple-50"><i class="fa-solid fa-users-gear w-5"></i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ</button>
            </div>
        </div>
        <div class="p-4 border-t border-slate-100">
            <button id="btnConnectLine" onclick="connectLine()" class="hidden w-full mb-3 text-xs bg-[#06c755] text-white hover:bg-[#05b34c] py-2 rounded-lg transition items-center justify-center gap-2"><i class="fa-brands fa-line text-lg"></i> ‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ó‡∏≤‡∏á LINE</button>
            
            <div class="flex items-center gap-3 cursor-pointer p-2 rounded-xl hover:bg-slate-50 transition" onclick="togglePassModal()">
                <div class="w-10 h-10 rounded-full bg-gradient-to-tr from-blue-400 to-indigo-500 flex items-center justify-center text-white font-bold shadow-md text-sm" id="avt">U</div>
                <div class="overflow-hidden flex-1">
                    <p class="text-sm font-bold text-slate-700 truncate" id="uName">User</p>
                    <p class="text-xs text-slate-400">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</p>
                </div>
            </div>
            <button onclick="logout()" class="w-full mt-2 text-xs text-red-500 hover:bg-red-50 py-2 rounded-lg transition">Sign Out</button>
        </div>
    </nav>

    <main id="main" class="flex-1 h-full overflow-y-auto p-6 hidden relative bg-[#f8fafc]">
        <div id="loader" class="loading-overlay hidden">
            <div class="flex flex-col items-center">
                <div class="animate-spin rounded-full h-10 w-10 border-4 border-indigo-500 border-t-transparent"></div>
            </div>
        </div>
        
        <div id="view-dashboard" class="page-transition max-w-7xl mx-auto">
            <div class="flex justify-between items-center mb-8">
                <div><h2 class="text-2xl font-bold text-slate-800">‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° (Dashboard)</h2><p class="text-slate-500 text-sm">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</p></div>
                <div class="flex gap-3">
                    <select id="dashMonth" class="bg-white border-none shadow-sm rounded-lg px-4 py-2 text-sm outline-none ring-1 ring-slate-200 focus:ring-indigo-500"></select>
                    <button onclick="loadDashboard()" class="bg-indigo-500 text-white px-4 py-2 rounded-lg shadow hover:bg-indigo-600 text-sm transition"><i class="fa-solid fa-rotate-right mr-2"></i>Refresh</button>
                </div>
            </div>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                <div class="lg:col-span-2 bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                    <h3 class="font-bold text-slate-700 mb-4 flex items-center gap-2"><span class="w-8 h-8 rounded-lg bg-orange-100 text-orange-500 flex items-center justify-center"><i class="fa-solid fa-user-clock"></i></span>‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£‡∏ó‡∏µ‡πà‡∏•‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h3>
                    <div id="whoOffContainer" class="flex flex-wrap gap-3 min-h-[60px] items-center">
                        <span class="text-slate-400 text-sm italic">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</span>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-24 h-24 bg-pink-50 rounded-full -mr-8 -mt-8 opacity-50"></div>
                    <p class="text-slate-500 text-sm relative z-10">‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤‡∏ß‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß‡∏õ‡∏µ‡∏ô‡∏µ‡πâ</p>
                    <div class="flex items-end gap-2 mt-2 relative z-10">
                        <h3 class="text-4xl font-bold text-slate-800" id="statPersonal">0</h3>
                        <span class="text-slate-400 text-sm mb-1 font-medium">/‡∏ô‡∏±‡∏ö‡∏ï‡∏≤‡∏°‡∏õ‡∏µ</span>
                    </div>
                    <div class="w-full bg-slate-100 rounded-full h-3 mt-4 overflow-hidden relative z-10">
                        <div class="bg-gradient-to-r from-pink-400 to-rose-500 h-3 rounded-full transition-all duration-1000 ease-out" id="statBar" style="width:0%"></div>
                    </div>
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100"><h3 class="font-bold mb-6 text-slate-700">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h3><canvas id="chartDaily" height="200"></canvas></div>
                <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100"><h3 class="font-bold mb-6 text-slate-700">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤</h3><div class="h-64 flex justify-center"><canvas id="chartType"></canvas></div></div>
            </div>
        </div>

        <div id="view-form" class="hidden page-transition max-w-3xl mx-auto">
            <div class="bg-white p-10 rounded-3xl shadow-lg border border-slate-100">
                <div class="flex items-center gap-4 mb-8 pb-6 border-b border-slate-100">
                    <div class="w-14 h-14 bg-green-100 text-green-600 rounded-2xl flex items-center justify-center text-2xl"><i class="fa-solid fa-file-contract"></i></div>
                    <div><h2 class="text-2xl font-bold text-slate-800">‡∏•‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ß‡∏±‡∏ô‡∏•‡∏≤</h2><p class="text-slate-400 text-sm">‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô</p></div>
                </div>
                <form id="leaveForm" class="space-y-6">
                    <div class="grid grid-cols-2 gap-6">
                        <div><label class="text-sm font-bold text-slate-600 block mb-2">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£</label><select id="inpPh" class="w-full border-slate-200 rounded-xl p-3 bg-slate-50 focus:ring-2 focus:ring-green-400 focus:bg-white transition"></select></div>
                        <div><label class="text-sm font-bold text-slate-600 block mb-2">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label><select id="inpType" class="w-full border-slate-200 rounded-xl p-3 bg-slate-50 focus:ring-2 focus:ring-green-400 focus:bg-white transition"></select></div>
                    </div>
                    <div><label class="text-sm font-bold text-slate-600 block mb-2">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label><input id="inpNote" class="w-full border-slate-200 rounded-xl p-3 bg-slate-50 focus:ring-2 focus:ring-green-400 focus:bg-white transition" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•..."></div>
                    <div class="bg-indigo-50/60 p-6 rounded-2xl border border-indigo-100">
                        <label class="text-sm font-bold text-indigo-800 mb-4 block"><i class="fa-regular fa-calendar-check mr-2"></i>‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏≤</label>
                        <div class="grid grid-cols-2 gap-6">
                            <input type="date" id="inpStart" class="border-indigo-200 rounded-xl p-3 focus:ring-2 focus:ring-indigo-400 text-indigo-900" required>
                            <input type="date" id="inpEnd" class="border-indigo-200 rounded-xl p-3 focus:ring-2 focus:ring-indigo-400 text-indigo-900" required>
                        </div>
                    </div>
                    <button class="w-full bg-green-500 hover:bg-green-600 text-white font-bold py-4 rounded-xl shadow-lg hover:shadow-xl transition-all transform hover:-translate-y-1">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏•‡∏≤</button>
                </form>
            </div>
        </div>

        <div id="view-calendar" class="hidden page-transition h-full flex flex-col">
            <div class="bg-white p-6 rounded-3xl shadow-sm border border-slate-100 flex-1 relative">
                <div id="calendar" class="h-full"></div>
            </div>
        </div>

        <div id="view-history" class="hidden page-transition max-w-5xl mx-auto">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-slate-800">‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ç‡∏≠‡∏á‡∏â‡∏±‡∏ô</h2>
                <button onclick="window.print()" class="bg-slate-700 text-white px-4 py-2 rounded-lg hover:bg-slate-800 text-sm shadow"><i class="fa-solid fa-print mr-2"></i>‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
            </div>
            <div class="bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden">
                <table class="w-full text-left text-sm">
                    <thead class="bg-slate-50 text-slate-600 uppercase text-xs font-bold"><tr><th class="p-4">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th class="p-4">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th class="p-4">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th><th class="p-4 text-right">Action</th></tr></thead>
                    <tbody id="histBody" class="divide-y divide-slate-100"></tbody>
                </table>
            </div>
        </div>

        <div id="view-adminQuota" class="hidden page-transition max-w-4xl mx-auto space-y-6">
            <div class="bg-white p-8 rounded-3xl shadow-sm border border-orange-100 relative overflow-hidden">
                <div class="absolute left-0 top-0 h-full w-1.5 bg-orange-400"></div>
                <h2 class="text-xl font-bold mb-6 text-slate-800">üîí ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤‡∏û‡∏¥‡πÄ‡∏®‡∏© / Lock ‡∏ß‡∏±‡∏ô</h2>
                <div class="flex flex-wrap items-end gap-4">
                    <div><label class="text-xs font-bold text-slate-400 block mb-1">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label><input type="date" id="admDate" class="border rounded-lg p-3 bg-slate-50"></div>
                    <div><label class="text-xs font-bold text-slate-400 block mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô (0=Lock)</label><input type="number" id="admQ" class="border rounded-lg p-3 w-28 bg-slate-50"></div>
                    <button onclick="setLock()" class="bg-orange-500 text-white px-6 py-3 rounded-lg font-bold hover:bg-orange-600 shadow">Update</button>
                    <button onclick="setLock(true)" class="text-slate-400 underline text-sm ml-2 hover:text-red-500">Reset</button>
                </div>
            </div>
            <div class="bg-white p-8 rounded-3xl shadow-sm border border-red-100 relative overflow-hidden">
                <div class="absolute left-0 top-0 h-full w-1.5 bg-red-500"></div>
                <h2 class="text-xl font-bold mb-6 text-slate-800">üìÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏ô‡∏±‡∏Å‡∏Ç‡∏±‡∏ï‡∏§‡∏Å‡∏©‡πå</h2>
                <div class="flex gap-4 items-end">
                    <input type="date" id="holDate" class="border rounded-lg p-3 bg-slate-50">
                    <input type="text" id="holName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î" class="border rounded-lg p-3 w-full bg-slate-50">
                    <button onclick="addHoliday()" class="bg-red-500 text-white px-6 py-3 rounded-lg font-bold hover:bg-red-600 shadow">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </div>
            </div>
        </div>
        <div id="view-adminReport" class="hidden page-transition space-y-6 max-w-6xl mx-auto">
             <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-100">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="font-bold text-lg text-slate-800">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏£‡∏∏‡∏õ (Export)</h3>
                    <div class="flex gap-2">
                        <input type="date" id="repS" class="border rounded-lg p-2 text-sm">
                        <input type="date" id="repE" class="border rounded-lg p-2 text-sm">
                        <button onclick="loadReport()" class="bg-indigo-100 text-indigo-600 px-4 py-2 rounded-lg font-bold hover:bg-indigo-200 text-sm">View</button>
                        <button onclick="exportExcel()" class="bg-green-600 text-white px-4 py-2 rounded-lg font-bold hover:bg-green-700 text-sm shadow">Excel</button>
                    </div>
                </div>
                <div class="max-h-96 overflow-y-auto rounded-xl border border-slate-100"><table class="w-full text-sm text-left"><tbody id="repBody" class="divide-y divide-slate-50"></tbody></table></div>
            </div>
        </div>
        <div id="view-adminUsers" class="hidden page-transition max-w-5xl mx-auto">
            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-100">
                    <h3 class="font-bold text-lg mb-6 text-slate-800">‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£‡πÉ‡∏´‡∏°‡πà</h3>
                    <form onsubmit="addUser(event)" class="space-y-4">
                        <input id="newUName" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•" class="w-full border-slate-200 rounded-xl p-3 bg-slate-50 focus:bg-white transition" required>
                        <div class="flex gap-4">
                            <input id="newUUser" placeholder="Username" class="w-full border-slate-200 rounded-xl p-3 bg-slate-50 focus:bg-white transition" required>
                            <input id="newUPass" placeholder="Password" class="w-full border-slate-200 rounded-xl p-3 bg-slate-50 focus:bg-white transition" required>
                        </div>
                        <button class="bg-blue-500 text-white w-full py-3 rounded-xl font-bold hover:bg-blue-600 shadow">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                    </form>
                </div>
                <div class="bg-white p-8 rounded-3xl shadow-sm border border-slate-100">
                    <h3 class="font-bold text-lg mb-6 text-slate-800">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏Å‡∏≤‡∏£‡∏•‡∏≤</h3>
                    <form onsubmit="addType(event)" class="flex gap-4">
                        <input id="newTName" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó" class="w-full border-slate-200 rounded-xl p-3 bg-slate-50 focus:bg-white transition" required>
                        <button class="bg-emerald-500 text-white px-6 rounded-xl font-bold hover:bg-emerald-600 shadow">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                    </form>
                </div>
            </div>
        </div>
    </main>

    <div id="passModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/30 backdrop-blur-sm hidden">
        <div class="bg-white p-8 rounded-2xl w-96 shadow-2xl">
            <h3 class="text-xl font-bold mb-6 text-slate-800">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</h3>
            <div class="space-y-4">
                <input type="password" id="oldPass" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÄ‡∏î‡∏¥‡∏°" class="w-full border-slate-200 p-3 rounded-xl bg-slate-50 outline-none">
                <input type="password" id="newPass" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà" class="w-full border-slate-200 p-3 rounded-xl bg-slate-50 outline-none">
            </div>
            <div class="flex justify-end gap-3 mt-8">
                <button onclick="togglePassModal()" class="px-4 py-2 text-slate-500 hover:bg-slate-100 rounded-lg">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button onclick="changePass()" class="px-6 py-2 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 shadow">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button>
            </div>
        </div>
    </div>

    <div id="printSection" class="hidden bg-white p-12">
        <h1 class="text-3xl font-bold text-center mb-2">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏•‡∏≤</h1>
        <p class="text-center text-slate-500 mb-8">‡πÄ‡∏†‡∏™‡∏±‡∏ä‡∏Å‡∏£: <span id="pName" class="font-bold text-black"></span></p>
        <table class="w-full border border-black text-sm">
            <thead><tr class="bg-gray-100"><th class="border border-black p-3">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</th><th class="border border-black p-3">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</th><th class="border border-black p-3">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</th></tr></thead>
            <tbody id="pBody"></tbody>
        </table>
    </div>

    <script>
        // *** REPLACE WITH YOUR URL ***
        const API = 'https://script.google.com/macros/s/AKfycbz5Jzvch3SU0L_-CJqWgKZ_Sy5kv9Zm0zA0ItvEj0KYlEVk7Jwzf6wACNkv-nIPMT7D/exec'; 
        
        // *** ‡πÉ‡∏™‡πà LIFF ID ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏ü‡∏µ‡πÄ‡∏à‡∏≠‡∏£‡πå‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE (‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏´‡πâ‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡πà‡∏≤‡∏á) ***
        // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ LIFF ‡πÉ‡∏´‡πâ Admin ‡πÅ‡∏≠‡∏î‡πÑ‡∏•‡∏ô‡πå‡∏ö‡∏≠‡∏ó ‡πÅ‡∏•‡πâ‡∏ß‡∏û‡∏¥‡∏°‡∏û‡πå ID ‡∏°‡∏≤‡πÉ‡∏™‡πà‡πÉ‡∏ô Sheet Users ‡∏ä‡πà‡∏≠‡∏á G ‡πÄ‡∏≠‡∏á‡πÑ‡∏î‡πâ
        const LIFF_ID = ''; 

        let USER=null, DATA=null, CAL=null, CHART={};

        document.getElementById('loginForm').addEventListener('submit', async(e)=>{
            e.preventDefault();
            const btn = document.getElementById('loginBtn');
            const html = btn.innerHTML;
            btn.disabled=true; btn.innerHTML='<i class="fa-solid fa-circle-notch fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...';
            const res = await req({action:'login', username:document.getElementById('user').value, password:document.getElementById('pass').value});
            if(res.success){
                Swal.fire({icon:'success',title:'‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',text:'‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢',timer:1000,showConfirmButton:false});
                USER=res.user; init();
            } else {
                Swal.fire({icon:'error',title:'‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',text:res.message});
                btn.disabled=false; btn.innerHTML=html;
            }
        });

        async function init(){
            document.getElementById('loginPage').classList.add('hidden');
            document.getElementById('sidebar').classList.remove('hidden'); document.getElementById('sidebar').classList.add('flex');
            document.getElementById('main').classList.remove('hidden');
            document.getElementById('uName').innerText = USER.name; document.getElementById('avt').innerText = USER.name[0];
            if(USER.role==='admin') {
                document.getElementById('adminMenu').classList.remove('hidden');
                document.getElementById('btnConnectLine').classList.remove('hidden');
                if(USER.hasLine) document.getElementById('btnConnectLine').classList.add('hidden'); // ‡∏ã‡πà‡∏≠‡∏ô‡∏ñ‡πâ‡∏≤‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡πÅ‡∏•‡πâ‡∏ß
            }

            const res = await req({action:'init'}, true); DATA=res;
            const ph = document.getElementById('inpPh');
            ph.innerHTML='<option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>'+res.users.map(u=>`<option value="${u.name}">${u.name}</option>`);
            if(USER.role!=='admin'){ ph.value=USER.name; ph.disabled=true; }
            document.getElementById('inpType').innerHTML=res.types.map(t=>`<option value="${t.name}">${t.name}</option>`);
            initDash(); nav('dashboard');
            
            // Init LIFF (Optional)
            if(LIFF_ID) liff.init({ liffId: LIFF_ID });
        }

        function nav(id){
            document.querySelectorAll('.nav-item').forEach(b=>b.classList.remove('active'));
            event.currentTarget.classList.add('active');
            document.querySelectorAll('[id^="view-"]').forEach(v=>v.classList.add('hidden'));
            document.getElementById(`view-${id}`).classList.remove('hidden');
            if(id==='calendar') loadCal();
            if(id==='history') loadHist();
            if(id==='adminReport') loadLogs();
        }

        // --- DASHBOARD & CALENDAR (FIXES) ---
        function initDash(){
            const m=document.getElementById('dashMonth');
            ['‡∏°.‡∏Ñ.','‡∏Å.‡∏û.','‡∏°‡∏µ.‡∏Ñ.','‡πÄ‡∏°.‡∏¢.','‡∏û.‡∏Ñ.','‡∏°‡∏¥.‡∏¢.','‡∏Å.‡∏Ñ.','‡∏™.‡∏Ñ.','‡∏Å.‡∏¢.','‡∏ï.‡∏Ñ.','‡∏û.‡∏¢.','‡∏ò.‡∏Ñ.'].forEach((x,i)=>m.innerHTML+=`<option value="${i+1}">${x}</option>`);
            m.value=new Date().getMonth()+1; loadDash();
        }
        async function loadDash(){
            const res = await req({action:'dashboard', month:document.getElementById('dashMonth').value, year:new Date().getFullYear()});
            const limit = DATA.userLimit || 15;
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å Server ‡∏ñ‡πâ‡∏≤‡∏ó‡∏≥‡πÑ‡∏î‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ä‡πâ‡∏Ñ‡πà‡∏≤‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß
            document.getElementById('statPersonal').innerText = '?'; // ‡∏Ñ‡∏ß‡∏£‡∏î‡∏∂‡∏á‡∏à‡∏≤‡∏Å API myHistory
            
            const wc = document.getElementById('whoOffContainer');
            wc.innerHTML = res.whoOff.length ? '' : '<p class="text-slate-400 text-sm">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÉ‡∏Ñ‡∏£‡∏•‡∏≤</p>';
            res.whoOff.forEach(p => {
                const color = (DATA.types.find(t=>t.name===p.type)||{}).color || '#94a3b8';
                wc.innerHTML += `<div class="flex items-center gap-3 bg-slate-50 px-4 py-2 rounded-xl border border-slate-200"><div class="w-3 h-3 rounded-full shadow-sm" style="background:${color}"></div><div><p class="text-sm font-bold text-slate-700 leading-tight">${p.name}</p><p class="text-[10px] text-slate-500">${p.type} (${p.date})</p></div></div>`;
            });

            if(CHART.d) CHART.d.destroy(); CHART.d = new Chart(document.getElementById('chartDaily'), {type:'bar',data:{labels:Object.keys(res.daily),datasets:[{label:'‡∏Ñ‡∏ô',data:Object.values(res.daily),backgroundColor:'#6366f1',borderRadius:4}]}});
            if(CHART.t) CHART.t.destroy(); CHART.t = new Chart(document.getElementById('chartType'), {type:'doughnut',data:{labels:Object.keys(res.types),datasets:[{data:Object.values(res.types),backgroundColor:['#6366f1','#ec4899','#10b981','#f59e0b']}]}});
        }

        async function loadCal(){
            if(CAL) { CAL.destroy(); CAL=null; }
            document.getElementById('loader').classList.remove('hidden');
            
            CAL = new FullCalendar.Calendar(document.getElementById('calendar'), {
                initialView:'dayGridMonth', locale:'th', height:'100%',
                headerToolbar: { left: 'prev,next today', center: 'title', right: 'dayGridMonth,listMonth' },
                dayMaxEventRows: false,
                events: async(info, success) => {
                    try {
                        const leaves = await req({action:'calendar', start:info.startStr, end:info.endStr});
                        const counts = {};
                        leaves.forEach(l => { counts[l.start] = (counts[l.start] || 0) + 1; });
                        window.calendarCounts = counts; 
                        const holidays = DATA.holidays.map(h => ({ title: `üõë ${h.name}`, start: h.date, display: 'background', color:'#fee2e2' }));
                        document.getElementById('loader').classList.add('hidden');
                        success([...leaves, ...holidays]);
                    } catch(e) { document.getElementById('loader').classList.add('hidden'); console.error(e); }
                },
                eventContent: function(arg) {
                    if (arg.event.display === 'background') return;
                    const { type, note } = arg.event.extendedProps;
                    return { html: `<div class="fc-event-main"><span class="evt-name">${arg.event.title}</span><span class="evt-type">${type}</span>${note ? `<span class="evt-note">${note}</span>` : ''}</div>` };
                },
                dayCellDidMount: (arg) => {
                    // ‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡∏™‡∏£‡πâ‡∏≤‡∏á String YYYY-MM-DD ‡∏à‡∏≤‡∏Å Local Date ‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô toISOString()
                    const d = arg.date;
                    const year = d.getFullYear();
                    const month = String(d.getMonth() + 1).padStart(2, '0');
                    const day = String(d.getDate()).padStart(2, '0');
                    const dateStr = `${year}-${month}-${day}`;

                    setTimeout(() => {
                        // ‡πÉ‡∏ä‡πâ dateStr ‡∏ó‡∏µ‡πà‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡πÅ‡∏ó‡∏ô
                        if(window.calendarCounts && window.calendarCounts[dateStr]) {
                            const badge = document.createElement('div');
                            badge.className = 'day-count-badge';
                            badge.innerText = window.calendarCounts[dateStr];
                            
                            const frame = arg.el.querySelector('.fc-daygrid-day-top');
                            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡∏£‡πâ‡∏≤‡∏á badge ‡∏ã‡πâ‡∏≥‡∏ã‡πâ‡∏≠‡∏ô
                            if(frame && !frame.querySelector('.day-count-badge')) {
                                frame.appendChild(badge);
                            }
                        }
                    }, 50); // ‡∏•‡∏î delay ‡∏•‡∏á‡∏ô‡∏¥‡∏î‡∏´‡∏ô‡πà‡∏≠‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏£‡∏π‡πâ‡∏™‡∏∂‡∏Å‡πÄ‡∏£‡πá‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô
                }
            });
            CAL.render();
        }

        // --- LINE CONNECTION ---
        async function connectLine() {
            if(!LIFF_ID) return Swal.fire('‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ú‡πà‡∏≤‡∏ô line', '‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤', 'info');
            if(!liff.isLoggedIn()) { liff.login(); return; }
            const profile = await liff.getProfile();
            const res = await req({action:'regisLine', userId:USER.id, lineId:profile.userId}, true);
            if(res.success) Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', '‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ LINE ‡πÅ‡∏•‡πâ‡∏ß', 'success');
        }

        // --- CORE ACTIONS ---
        document.getElementById('leaveForm').addEventListener('submit', async(e)=>{
            e.preventDefault();
            const res = await req({
                action:'submit', pharmacist:document.getElementById('inpPh').value, type:document.getElementById('inpType').value,
                note:document.getElementById('inpNote').value, start:document.getElementById('inpStart').value, end:document.getElementById('inpEnd').value,
                userId:USER.id, role:USER.role
            }, true);
            if(res.success){ Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à',res.message,'success'); document.getElementById('inpNote').value=''; loadDash(); }
            else Swal.fire('‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô',res.message,'warning');
        });

        async function req(body, load=false){
            if(load) document.getElementById('loader').classList.remove('hidden');
            try {
                const r = await fetch(API, {method:'POST', body:JSON.stringify(body)}).then(x=>x.json());
                if(load) document.getElementById('loader').classList.add('hidden');
                return r;
            } catch(e){
                if(load) document.getElementById('loader').classList.add('hidden');
                console.error(e); return {success:false, message:'Connection Error'};
            }
        }
        function togglePassModal(){ document.getElementById('passModal').classList.toggle('hidden'); }
        function logout(){ location.reload(); }
        async function changePass(){
            const oldP=document.getElementById('oldPass').value, newP=document.getElementById('newPass').value;
            if(!oldP||!newP) return Swal.fire('‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô','‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö','warning');
            const res = await req({action:'chgPass', userId:USER.id, oldPass:oldP, newPass:newP}, true);
            if(res.success){ Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏•‡πâ‡∏ß','success'); togglePassModal(); } else Swal.fire('‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î',res.message,'error');
        }
        async function loadHist(){
            const res = await req({action:'myHistory', userId:USER.id});
            const tb = document.getElementById('histBody'); tb.innerHTML = res.length?'':'<tr><td colspan="4" class="p-4 text-center text-slate-400">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥</td></tr>';
            const used=res.length, lim=DATA.userLimit||15;
            document.getElementById('statPersonal').innerHTML=`${used}<span class="text-sm text-slate-400 font-normal">/${lim} ‡∏ß‡∏±‡∏ô</span>`;
            document.getElementById('statBar').style.width=Math.min((used/lim)*100,100)+'%';
            res.forEach(r=>{
                tb.innerHTML+=`<tr class="border-b hover:bg-slate-50 transition"><td class="p-4 font-bold text-indigo-900">${r.date}</td><td class="p-4"><span class="bg-indigo-50 text-indigo-600 px-2 py-1 rounded text-xs font-bold">${r.type}</span></td><td class="p-4 text-slate-500">${r.note||'-'}</td><td class="p-4 text-right"><button onclick="del('${r.id}')" class="text-red-400 hover:text-red-600"><i class="fa-solid fa-trash"></i></button></td></tr>`;
            });
            document.getElementById('pName').innerText = USER.name;
            document.getElementById('pBody').innerHTML = res.map(r=>`<tr><td class="border border-black p-2">${r.date}</td><td class="border border-black p-2">${r.type}</td><td class="border border-black p-2">${r.note||'-'}</td></tr>`).join('');
        }
        async function del(id){ if(await Swal.fire({title:'‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏•‡∏ö?',icon:'warning',showCancelButton:true}).then(r=>r.isConfirmed)){ await req({action:'delete', id, userId:USER.id}, true); loadHist(); } }
        async function setLock(rst=false){ const d=document.getElementById('admDate').value, q=document.getElementById('admQ').value; if(!d) return; await req({action:'setLock', date:d, quota:rst?null:q, userId:USER.id}, true); Swal.fire('Info','‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß','success'); }
        async function addHoliday(){ const d=document.getElementById('holDate').value, n=document.getElementById('holName').value; if(!d||!n) return; await req({action:'addHoliday', date:d, name:n, userId:USER.id}, true); Swal.fire('Success','‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏•‡πâ‡∏ß','success'); }
        async function loadReport(){ const s=document.getElementById('repS').value, e=document.getElementById('repE').value; if(!s) return; const res=await req({action:'report', start:s, end:e}); DATA.report=res; document.getElementById('repBody').innerHTML=res.map(r=>`<tr class="border-b hover:bg-slate-50"><td class="p-3">${r.date}</td><td class="p-3 font-bold">${r.pharmacist}</td><td class="p-3"><span class="bg-slate-100 px-2 rounded text-xs">${r.type}</span></td><td class="p-3 text-slate-500">${r.note||''}</td></tr>`).join(''); }
        function exportExcel(){ if(!DATA.report) return Swal.fire('Info','‡∏Å‡∏î‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô','info'); XLSX.writeFile(XLSX.utils.book_new(XLSX.utils.book_append_sheet(XLSX.utils.book_new(), XLSX.utils.json_to_sheet(DATA.report), "Report")), "Report.xlsx"); }
        async function loadLogs(){ const res=await req({action:'getLogs'}); document.getElementById('logBody').innerHTML=res.map(l=>`<div class="border-b py-2"><span class="text-xs text-slate-400 mr-2">[${l.time}]</span> <strong class="text-indigo-600">${l.user}</strong>: ${l.action} <span class="text-slate-500 text-xs">${l.details}</span></div>`).join(''); }
        async function addUser(e){ e.preventDefault(); await req({action:'addUser', name:document.getElementById('newUName').value, username:document.getElementById('newUUser').value, password:document.getElementById('newUPass').value}, true); Swal.fire('Added','','success'); }
        async function addType(e){ e.preventDefault(); await req({action:'addType', name:document.getElementById('newTName').value, color:'#555'}, true); Swal.fire('Added','','success'); }
    </script>
</body>
</html>
